{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport * as React from 'react';\nimport useEventCallback from '@mui/utils/useEventCallback';\nimport ownerDocument from '@mui/utils/ownerDocument';\nimport { populateInstance, populatePublicAPI } from '../../useTreeView/useTreeView.utils';\nimport { useInstanceEventHandler } from '../../hooks/useInstanceEventHandler';\nimport { getActiveElement } from '../../utils/utils';\nconst useTabbableItemId = (instance, selectedItems) => {\n  const isItemVisible = itemId => {\n    const node = instance.getNode(itemId);\n    return node && (node.parentId == null || instance.isNodeExpanded(node.parentId));\n  };\n  let tabbableItemId;\n  if (Array.isArray(selectedItems)) {\n    tabbableItemId = selectedItems.find(isItemVisible);\n  } else if (selectedItems != null && isItemVisible(selectedItems)) {\n    tabbableItemId = selectedItems;\n  }\n  if (tabbableItemId == null) {\n    tabbableItemId = instance.getNavigableChildrenIds(null)[0];\n  }\n  return tabbableItemId;\n};\nexport const useTreeViewFocus = ({\n  instance,\n  publicAPI,\n  params,\n  state,\n  setState,\n  models,\n  rootRef\n}) => {\n  const tabbableItemId = useTabbableItemId(instance, models.selectedItems.value);\n  const setFocusedItemId = useEventCallback(itemId => {\n    const cleanItemId = typeof itemId === 'function' ? itemId(state.focusedNodeId) : itemId;\n    if (state.focusedNodeId !== cleanItemId) {\n      setState(prevState => _extends({}, prevState, {\n        focusedNodeId: cleanItemId\n      }));\n    }\n  });\n  const isTreeViewFocused = React.useCallback(() => !!rootRef.current && rootRef.current.contains(getActiveElement(ownerDocument(rootRef.current))), [rootRef]);\n  const isNodeFocused = React.useCallback(itemId => state.focusedNodeId === itemId && isTreeViewFocused(), [state.focusedNodeId, isTreeViewFocused]);\n  const isNodeVisible = itemId => {\n    const node = instance.getNode(itemId);\n    return node && (node.parentId == null || instance.isNodeExpanded(node.parentId));\n  };\n  const innerFocusItem = (event, itemId) => {\n    const node = instance.getNode(itemId);\n    const itemElement = document.getElementById(instance.getTreeItemId(itemId, node.idAttribute));\n    if (itemElement) {\n      itemElement.focus();\n    }\n    setFocusedItemId(itemId);\n    if (params.onItemFocus) {\n      params.onItemFocus(event, itemId);\n    }\n  };\n  const focusItem = useEventCallback((event, nodeId) => {\n    // If we receive a nodeId, and it is visible, the focus will be set to it\n    if (isNodeVisible(nodeId)) {\n      innerFocusItem(event, nodeId);\n    }\n  });\n  const focusDefaultNode = useEventCallback(event => {\n    let nodeToFocusId;\n    if (Array.isArray(models.selectedItems.value)) {\n      nodeToFocusId = models.selectedItems.value.find(isNodeVisible);\n    } else if (models.selectedItems.value != null && isNodeVisible(models.selectedItems.value)) {\n      nodeToFocusId = models.selectedItems.value;\n    }\n    if (nodeToFocusId == null) {\n      nodeToFocusId = instance.getNavigableChildrenIds(null)[0];\n    }\n    innerFocusItem(event, nodeToFocusId);\n  });\n  const removeFocusedItem = useEventCallback(() => {\n    if (state.focusedNodeId == null) {\n      return;\n    }\n    const node = instance.getNode(state.focusedNodeId);\n    const itemElement = document.getElementById(instance.getTreeItemId(state.focusedNodeId, node.idAttribute));\n    if (itemElement) {\n      itemElement.blur();\n    }\n    setFocusedItemId(null);\n  });\n  const canItemBeTabbed = itemId => itemId === tabbableItemId;\n  populateInstance(instance, {\n    isNodeFocused,\n    canItemBeTabbed,\n    focusItem,\n    focusDefaultNode,\n    removeFocusedItem\n  });\n  populatePublicAPI(publicAPI, {\n    focusItem\n  });\n  useInstanceEventHandler(instance, 'removeNode', ({\n    id\n  }) => {\n    if (state.focusedNodeId === id) {\n      instance.focusDefaultNode(null);\n    }\n  });\n  const createHandleFocus = otherHandlers => event => {\n    otherHandlers.onFocus?.(event);\n    // if the event bubbled (which is React specific) we don't want to steal focus\n    if (event.target === event.currentTarget) {\n      instance.focusDefaultNode(event);\n    }\n  };\n  const focusedNode = instance.getNode(state.focusedNodeId);\n  const activeDescendant = focusedNode ? instance.getTreeItemId(focusedNode.id, focusedNode.idAttribute) : null;\n  return {\n    getRootProps: otherHandlers => ({\n      onFocus: createHandleFocus(otherHandlers),\n      'aria-activedescendant': activeDescendant ?? undefined\n    })\n  };\n};\nuseTreeViewFocus.getInitialState = () => ({\n  focusedNodeId: null\n});\nuseTreeViewFocus.params = {\n  onItemFocus: true\n};","map":{"version":3,"names":["_extends","React","useEventCallback","ownerDocument","populateInstance","populatePublicAPI","useInstanceEventHandler","getActiveElement","useTabbableItemId","instance","selectedItems","isItemVisible","itemId","node","getNode","parentId","isNodeExpanded","tabbableItemId","Array","isArray","find","getNavigableChildrenIds","useTreeViewFocus","publicAPI","params","state","setState","models","rootRef","value","setFocusedItemId","cleanItemId","focusedNodeId","prevState","isTreeViewFocused","useCallback","current","contains","isNodeFocused","isNodeVisible","innerFocusItem","event","itemElement","document","getElementById","getTreeItemId","idAttribute","focus","onItemFocus","focusItem","nodeId","focusDefaultNode","nodeToFocusId","removeFocusedItem","blur","canItemBeTabbed","id","createHandleFocus","otherHandlers","onFocus","target","currentTarget","focusedNode","activeDescendant","getRootProps","undefined","getInitialState"],"sources":["/Users/xander/node_modules/@mui/x-tree-view/internals/plugins/useTreeViewFocus/useTreeViewFocus.js"],"sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport * as React from 'react';\nimport useEventCallback from '@mui/utils/useEventCallback';\nimport ownerDocument from '@mui/utils/ownerDocument';\nimport { populateInstance, populatePublicAPI } from '../../useTreeView/useTreeView.utils';\nimport { useInstanceEventHandler } from '../../hooks/useInstanceEventHandler';\nimport { getActiveElement } from '../../utils/utils';\nconst useTabbableItemId = (instance, selectedItems) => {\n  const isItemVisible = itemId => {\n    const node = instance.getNode(itemId);\n    return node && (node.parentId == null || instance.isNodeExpanded(node.parentId));\n  };\n  let tabbableItemId;\n  if (Array.isArray(selectedItems)) {\n    tabbableItemId = selectedItems.find(isItemVisible);\n  } else if (selectedItems != null && isItemVisible(selectedItems)) {\n    tabbableItemId = selectedItems;\n  }\n  if (tabbableItemId == null) {\n    tabbableItemId = instance.getNavigableChildrenIds(null)[0];\n  }\n  return tabbableItemId;\n};\nexport const useTreeViewFocus = ({\n  instance,\n  publicAPI,\n  params,\n  state,\n  setState,\n  models,\n  rootRef\n}) => {\n  const tabbableItemId = useTabbableItemId(instance, models.selectedItems.value);\n  const setFocusedItemId = useEventCallback(itemId => {\n    const cleanItemId = typeof itemId === 'function' ? itemId(state.focusedNodeId) : itemId;\n    if (state.focusedNodeId !== cleanItemId) {\n      setState(prevState => _extends({}, prevState, {\n        focusedNodeId: cleanItemId\n      }));\n    }\n  });\n  const isTreeViewFocused = React.useCallback(() => !!rootRef.current && rootRef.current.contains(getActiveElement(ownerDocument(rootRef.current))), [rootRef]);\n  const isNodeFocused = React.useCallback(itemId => state.focusedNodeId === itemId && isTreeViewFocused(), [state.focusedNodeId, isTreeViewFocused]);\n  const isNodeVisible = itemId => {\n    const node = instance.getNode(itemId);\n    return node && (node.parentId == null || instance.isNodeExpanded(node.parentId));\n  };\n  const innerFocusItem = (event, itemId) => {\n    const node = instance.getNode(itemId);\n    const itemElement = document.getElementById(instance.getTreeItemId(itemId, node.idAttribute));\n    if (itemElement) {\n      itemElement.focus();\n    }\n    setFocusedItemId(itemId);\n    if (params.onItemFocus) {\n      params.onItemFocus(event, itemId);\n    }\n  };\n  const focusItem = useEventCallback((event, nodeId) => {\n    // If we receive a nodeId, and it is visible, the focus will be set to it\n    if (isNodeVisible(nodeId)) {\n      innerFocusItem(event, nodeId);\n    }\n  });\n  const focusDefaultNode = useEventCallback(event => {\n    let nodeToFocusId;\n    if (Array.isArray(models.selectedItems.value)) {\n      nodeToFocusId = models.selectedItems.value.find(isNodeVisible);\n    } else if (models.selectedItems.value != null && isNodeVisible(models.selectedItems.value)) {\n      nodeToFocusId = models.selectedItems.value;\n    }\n    if (nodeToFocusId == null) {\n      nodeToFocusId = instance.getNavigableChildrenIds(null)[0];\n    }\n    innerFocusItem(event, nodeToFocusId);\n  });\n  const removeFocusedItem = useEventCallback(() => {\n    if (state.focusedNodeId == null) {\n      return;\n    }\n    const node = instance.getNode(state.focusedNodeId);\n    const itemElement = document.getElementById(instance.getTreeItemId(state.focusedNodeId, node.idAttribute));\n    if (itemElement) {\n      itemElement.blur();\n    }\n    setFocusedItemId(null);\n  });\n  const canItemBeTabbed = itemId => itemId === tabbableItemId;\n  populateInstance(instance, {\n    isNodeFocused,\n    canItemBeTabbed,\n    focusItem,\n    focusDefaultNode,\n    removeFocusedItem\n  });\n  populatePublicAPI(publicAPI, {\n    focusItem\n  });\n  useInstanceEventHandler(instance, 'removeNode', ({\n    id\n  }) => {\n    if (state.focusedNodeId === id) {\n      instance.focusDefaultNode(null);\n    }\n  });\n  const createHandleFocus = otherHandlers => event => {\n    otherHandlers.onFocus?.(event);\n    // if the event bubbled (which is React specific) we don't want to steal focus\n    if (event.target === event.currentTarget) {\n      instance.focusDefaultNode(event);\n    }\n  };\n  const focusedNode = instance.getNode(state.focusedNodeId);\n  const activeDescendant = focusedNode ? instance.getTreeItemId(focusedNode.id, focusedNode.idAttribute) : null;\n  return {\n    getRootProps: otherHandlers => ({\n      onFocus: createHandleFocus(otherHandlers),\n      'aria-activedescendant': activeDescendant ?? undefined\n    })\n  };\n};\nuseTreeViewFocus.getInitialState = () => ({\n  focusedNodeId: null\n});\nuseTreeViewFocus.params = {\n  onItemFocus: true\n};"],"mappings":"AAAA,OAAOA,QAAQ,MAAM,oCAAoC;AACzD,OAAO,KAAKC,KAAK,MAAM,OAAO;AAC9B,OAAOC,gBAAgB,MAAM,6BAA6B;AAC1D,OAAOC,aAAa,MAAM,0BAA0B;AACpD,SAASC,gBAAgB,EAAEC,iBAAiB,QAAQ,qCAAqC;AACzF,SAASC,uBAAuB,QAAQ,qCAAqC;AAC7E,SAASC,gBAAgB,QAAQ,mBAAmB;AACpD,MAAMC,iBAAiB,GAAGA,CAACC,QAAQ,EAAEC,aAAa,KAAK;EACrD,MAAMC,aAAa,GAAGC,MAAM,IAAI;IAC9B,MAAMC,IAAI,GAAGJ,QAAQ,CAACK,OAAO,CAACF,MAAM,CAAC;IACrC,OAAOC,IAAI,KAAKA,IAAI,CAACE,QAAQ,IAAI,IAAI,IAAIN,QAAQ,CAACO,cAAc,CAACH,IAAI,CAACE,QAAQ,CAAC,CAAC;EAClF,CAAC;EACD,IAAIE,cAAc;EAClB,IAAIC,KAAK,CAACC,OAAO,CAACT,aAAa,CAAC,EAAE;IAChCO,cAAc,GAAGP,aAAa,CAACU,IAAI,CAACT,aAAa,CAAC;EACpD,CAAC,MAAM,IAAID,aAAa,IAAI,IAAI,IAAIC,aAAa,CAACD,aAAa,CAAC,EAAE;IAChEO,cAAc,GAAGP,aAAa;EAChC;EACA,IAAIO,cAAc,IAAI,IAAI,EAAE;IAC1BA,cAAc,GAAGR,QAAQ,CAACY,uBAAuB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;EAC5D;EACA,OAAOJ,cAAc;AACvB,CAAC;AACD,OAAO,MAAMK,gBAAgB,GAAGA,CAAC;EAC/Bb,QAAQ;EACRc,SAAS;EACTC,MAAM;EACNC,KAAK;EACLC,QAAQ;EACRC,MAAM;EACNC;AACF,CAAC,KAAK;EACJ,MAAMX,cAAc,GAAGT,iBAAiB,CAACC,QAAQ,EAAEkB,MAAM,CAACjB,aAAa,CAACmB,KAAK,CAAC;EAC9E,MAAMC,gBAAgB,GAAG5B,gBAAgB,CAACU,MAAM,IAAI;IAClD,MAAMmB,WAAW,GAAG,OAAOnB,MAAM,KAAK,UAAU,GAAGA,MAAM,CAACa,KAAK,CAACO,aAAa,CAAC,GAAGpB,MAAM;IACvF,IAAIa,KAAK,CAACO,aAAa,KAAKD,WAAW,EAAE;MACvCL,QAAQ,CAACO,SAAS,IAAIjC,QAAQ,CAAC,CAAC,CAAC,EAAEiC,SAAS,EAAE;QAC5CD,aAAa,EAAED;MACjB,CAAC,CAAC,CAAC;IACL;EACF,CAAC,CAAC;EACF,MAAMG,iBAAiB,GAAGjC,KAAK,CAACkC,WAAW,CAAC,MAAM,CAAC,CAACP,OAAO,CAACQ,OAAO,IAAIR,OAAO,CAACQ,OAAO,CAACC,QAAQ,CAAC9B,gBAAgB,CAACJ,aAAa,CAACyB,OAAO,CAACQ,OAAO,CAAC,CAAC,CAAC,EAAE,CAACR,OAAO,CAAC,CAAC;EAC7J,MAAMU,aAAa,GAAGrC,KAAK,CAACkC,WAAW,CAACvB,MAAM,IAAIa,KAAK,CAACO,aAAa,KAAKpB,MAAM,IAAIsB,iBAAiB,CAAC,CAAC,EAAE,CAACT,KAAK,CAACO,aAAa,EAAEE,iBAAiB,CAAC,CAAC;EAClJ,MAAMK,aAAa,GAAG3B,MAAM,IAAI;IAC9B,MAAMC,IAAI,GAAGJ,QAAQ,CAACK,OAAO,CAACF,MAAM,CAAC;IACrC,OAAOC,IAAI,KAAKA,IAAI,CAACE,QAAQ,IAAI,IAAI,IAAIN,QAAQ,CAACO,cAAc,CAACH,IAAI,CAACE,QAAQ,CAAC,CAAC;EAClF,CAAC;EACD,MAAMyB,cAAc,GAAGA,CAACC,KAAK,EAAE7B,MAAM,KAAK;IACxC,MAAMC,IAAI,GAAGJ,QAAQ,CAACK,OAAO,CAACF,MAAM,CAAC;IACrC,MAAM8B,WAAW,GAAGC,QAAQ,CAACC,cAAc,CAACnC,QAAQ,CAACoC,aAAa,CAACjC,MAAM,EAAEC,IAAI,CAACiC,WAAW,CAAC,CAAC;IAC7F,IAAIJ,WAAW,EAAE;MACfA,WAAW,CAACK,KAAK,CAAC,CAAC;IACrB;IACAjB,gBAAgB,CAAClB,MAAM,CAAC;IACxB,IAAIY,MAAM,CAACwB,WAAW,EAAE;MACtBxB,MAAM,CAACwB,WAAW,CAACP,KAAK,EAAE7B,MAAM,CAAC;IACnC;EACF,CAAC;EACD,MAAMqC,SAAS,GAAG/C,gBAAgB,CAAC,CAACuC,KAAK,EAAES,MAAM,KAAK;IACpD;IACA,IAAIX,aAAa,CAACW,MAAM,CAAC,EAAE;MACzBV,cAAc,CAACC,KAAK,EAAES,MAAM,CAAC;IAC/B;EACF,CAAC,CAAC;EACF,MAAMC,gBAAgB,GAAGjD,gBAAgB,CAACuC,KAAK,IAAI;IACjD,IAAIW,aAAa;IACjB,IAAIlC,KAAK,CAACC,OAAO,CAACQ,MAAM,CAACjB,aAAa,CAACmB,KAAK,CAAC,EAAE;MAC7CuB,aAAa,GAAGzB,MAAM,CAACjB,aAAa,CAACmB,KAAK,CAACT,IAAI,CAACmB,aAAa,CAAC;IAChE,CAAC,MAAM,IAAIZ,MAAM,CAACjB,aAAa,CAACmB,KAAK,IAAI,IAAI,IAAIU,aAAa,CAACZ,MAAM,CAACjB,aAAa,CAACmB,KAAK,CAAC,EAAE;MAC1FuB,aAAa,GAAGzB,MAAM,CAACjB,aAAa,CAACmB,KAAK;IAC5C;IACA,IAAIuB,aAAa,IAAI,IAAI,EAAE;MACzBA,aAAa,GAAG3C,QAAQ,CAACY,uBAAuB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAC3D;IACAmB,cAAc,CAACC,KAAK,EAAEW,aAAa,CAAC;EACtC,CAAC,CAAC;EACF,MAAMC,iBAAiB,GAAGnD,gBAAgB,CAAC,MAAM;IAC/C,IAAIuB,KAAK,CAACO,aAAa,IAAI,IAAI,EAAE;MAC/B;IACF;IACA,MAAMnB,IAAI,GAAGJ,QAAQ,CAACK,OAAO,CAACW,KAAK,CAACO,aAAa,CAAC;IAClD,MAAMU,WAAW,GAAGC,QAAQ,CAACC,cAAc,CAACnC,QAAQ,CAACoC,aAAa,CAACpB,KAAK,CAACO,aAAa,EAAEnB,IAAI,CAACiC,WAAW,CAAC,CAAC;IAC1G,IAAIJ,WAAW,EAAE;MACfA,WAAW,CAACY,IAAI,CAAC,CAAC;IACpB;IACAxB,gBAAgB,CAAC,IAAI,CAAC;EACxB,CAAC,CAAC;EACF,MAAMyB,eAAe,GAAG3C,MAAM,IAAIA,MAAM,KAAKK,cAAc;EAC3Db,gBAAgB,CAACK,QAAQ,EAAE;IACzB6B,aAAa;IACbiB,eAAe;IACfN,SAAS;IACTE,gBAAgB;IAChBE;EACF,CAAC,CAAC;EACFhD,iBAAiB,CAACkB,SAAS,EAAE;IAC3B0B;EACF,CAAC,CAAC;EACF3C,uBAAuB,CAACG,QAAQ,EAAE,YAAY,EAAE,CAAC;IAC/C+C;EACF,CAAC,KAAK;IACJ,IAAI/B,KAAK,CAACO,aAAa,KAAKwB,EAAE,EAAE;MAC9B/C,QAAQ,CAAC0C,gBAAgB,CAAC,IAAI,CAAC;IACjC;EACF,CAAC,CAAC;EACF,MAAMM,iBAAiB,GAAGC,aAAa,IAAIjB,KAAK,IAAI;IAClDiB,aAAa,CAACC,OAAO,GAAGlB,KAAK,CAAC;IAC9B;IACA,IAAIA,KAAK,CAACmB,MAAM,KAAKnB,KAAK,CAACoB,aAAa,EAAE;MACxCpD,QAAQ,CAAC0C,gBAAgB,CAACV,KAAK,CAAC;IAClC;EACF,CAAC;EACD,MAAMqB,WAAW,GAAGrD,QAAQ,CAACK,OAAO,CAACW,KAAK,CAACO,aAAa,CAAC;EACzD,MAAM+B,gBAAgB,GAAGD,WAAW,GAAGrD,QAAQ,CAACoC,aAAa,CAACiB,WAAW,CAACN,EAAE,EAAEM,WAAW,CAAChB,WAAW,CAAC,GAAG,IAAI;EAC7G,OAAO;IACLkB,YAAY,EAAEN,aAAa,KAAK;MAC9BC,OAAO,EAAEF,iBAAiB,CAACC,aAAa,CAAC;MACzC,uBAAuB,EAAEK,gBAAgB,IAAIE;IAC/C,CAAC;EACH,CAAC;AACH,CAAC;AACD3C,gBAAgB,CAAC4C,eAAe,GAAG,OAAO;EACxClC,aAAa,EAAE;AACjB,CAAC,CAAC;AACFV,gBAAgB,CAACE,MAAM,GAAG;EACxBwB,WAAW,EAAE;AACf,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}