{"ast":null,"code":"import * as React from 'react';\nimport { TimerBasedCleanupTracking } from '../utils/cleanupTracking/TimerBasedCleanupTracking';\nimport { FinalizationRegistryBasedCleanupTracking } from '../utils/cleanupTracking/FinalizationRegistryBasedCleanupTracking';\n// We use class to make it easier to detect in heap snapshots by name\nclass ObjectToBeRetainedByReact {}\n\n// Based on https://github.com/Bnaya/use-dispose-uncommitted/blob/main/src/finalization-registry-based-impl.ts\n// Check https://github.com/facebook/react/issues/15317 to get more information\nexport function createUseInstanceEventHandler(registryContainer) {\n  let cleanupTokensCounter = 0;\n  return function useInstanceEventHandler(instance, eventName, handler) {\n    if (registryContainer.registry === null) {\n      registryContainer.registry = typeof FinalizationRegistry !== 'undefined' ? new FinalizationRegistryBasedCleanupTracking() : new TimerBasedCleanupTracking();\n    }\n    const [objectRetainedByReact] = React.useState(new ObjectToBeRetainedByReact());\n    const subscription = React.useRef(null);\n    const handlerRef = React.useRef();\n    handlerRef.current = handler;\n    const cleanupTokenRef = React.useRef(null);\n    if (!subscription.current && handlerRef.current) {\n      const enhancedHandler = (params, event) => {\n        if (!event.defaultMuiPrevented) {\n          var _handlerRef$current;\n          (_handlerRef$current = handlerRef.current) === null || _handlerRef$current === void 0 || _handlerRef$current.call(handlerRef, params, event);\n        }\n      };\n      subscription.current = instance.$$subscribeEvent(eventName, enhancedHandler);\n      cleanupTokensCounter += 1;\n      cleanupTokenRef.current = {\n        cleanupToken: cleanupTokensCounter\n      };\n      registryContainer.registry.register(objectRetainedByReact,\n      // The callback below will be called once this reference stops being retained\n      () => {\n        var _subscription$current;\n        (_subscription$current = subscription.current) === null || _subscription$current === void 0 || _subscription$current.call(subscription);\n        subscription.current = null;\n        cleanupTokenRef.current = null;\n      }, cleanupTokenRef.current);\n    } else if (!handlerRef.current && subscription.current) {\n      subscription.current();\n      subscription.current = null;\n      if (cleanupTokenRef.current) {\n        registryContainer.registry.unregister(cleanupTokenRef.current);\n        cleanupTokenRef.current = null;\n      }\n    }\n    React.useEffect(() => {\n      if (!subscription.current && handlerRef.current) {\n        const enhancedHandler = (params, event) => {\n          if (!event.defaultMuiPrevented) {\n            var _handlerRef$current2;\n            (_handlerRef$current2 = handlerRef.current) === null || _handlerRef$current2 === void 0 || _handlerRef$current2.call(handlerRef, params, event);\n          }\n        };\n        subscription.current = instance.$$subscribeEvent(eventName, enhancedHandler);\n      }\n      if (cleanupTokenRef.current && registryContainer.registry) {\n        // If the effect was called, it means that this render was committed\n        // so we can trust the cleanup function to remove the listener.\n        registryContainer.registry.unregister(cleanupTokenRef.current);\n        cleanupTokenRef.current = null;\n      }\n      return () => {\n        var _subscription$current2;\n        (_subscription$current2 = subscription.current) === null || _subscription$current2 === void 0 || _subscription$current2.call(subscription);\n        subscription.current = null;\n      };\n    }, [instance, eventName]);\n  };\n}\nconst registryContainer = {\n  registry: null\n};\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport const unstable_resetCleanupTracking = () => {\n  var _registryContainer$re;\n  (_registryContainer$re = registryContainer.registry) === null || _registryContainer$re === void 0 || _registryContainer$re.reset();\n  registryContainer.registry = null;\n};\nexport const useInstanceEventHandler = createUseInstanceEventHandler(registryContainer);","map":{"version":3,"names":["React","TimerBasedCleanupTracking","FinalizationRegistryBasedCleanupTracking","ObjectToBeRetainedByReact","createUseInstanceEventHandler","registryContainer","cleanupTokensCounter","useInstanceEventHandler","instance","eventName","handler","registry","FinalizationRegistry","objectRetainedByReact","useState","subscription","useRef","handlerRef","current","cleanupTokenRef","enhancedHandler","params","event","defaultMuiPrevented","_handlerRef$current","call","$$subscribeEvent","cleanupToken","register","_subscription$current","unregister","useEffect","_handlerRef$current2","_subscription$current2","unstable_resetCleanupTracking","_registryContainer$re","reset"],"sources":["/Users/xander/node_modules/@mui/x-tree-view/internals/hooks/useInstanceEventHandler.js"],"sourcesContent":["import * as React from 'react';\nimport { TimerBasedCleanupTracking } from '../utils/cleanupTracking/TimerBasedCleanupTracking';\nimport { FinalizationRegistryBasedCleanupTracking } from '../utils/cleanupTracking/FinalizationRegistryBasedCleanupTracking';\n// We use class to make it easier to detect in heap snapshots by name\nclass ObjectToBeRetainedByReact {}\n\n// Based on https://github.com/Bnaya/use-dispose-uncommitted/blob/main/src/finalization-registry-based-impl.ts\n// Check https://github.com/facebook/react/issues/15317 to get more information\nexport function createUseInstanceEventHandler(registryContainer) {\n  let cleanupTokensCounter = 0;\n  return function useInstanceEventHandler(instance, eventName, handler) {\n    if (registryContainer.registry === null) {\n      registryContainer.registry = typeof FinalizationRegistry !== 'undefined' ? new FinalizationRegistryBasedCleanupTracking() : new TimerBasedCleanupTracking();\n    }\n    const [objectRetainedByReact] = React.useState(new ObjectToBeRetainedByReact());\n    const subscription = React.useRef(null);\n    const handlerRef = React.useRef();\n    handlerRef.current = handler;\n    const cleanupTokenRef = React.useRef(null);\n    if (!subscription.current && handlerRef.current) {\n      const enhancedHandler = (params, event) => {\n        if (!event.defaultMuiPrevented) {\n          handlerRef.current?.(params, event);\n        }\n      };\n      subscription.current = instance.$$subscribeEvent(eventName, enhancedHandler);\n      cleanupTokensCounter += 1;\n      cleanupTokenRef.current = {\n        cleanupToken: cleanupTokensCounter\n      };\n      registryContainer.registry.register(objectRetainedByReact,\n      // The callback below will be called once this reference stops being retained\n      () => {\n        subscription.current?.();\n        subscription.current = null;\n        cleanupTokenRef.current = null;\n      }, cleanupTokenRef.current);\n    } else if (!handlerRef.current && subscription.current) {\n      subscription.current();\n      subscription.current = null;\n      if (cleanupTokenRef.current) {\n        registryContainer.registry.unregister(cleanupTokenRef.current);\n        cleanupTokenRef.current = null;\n      }\n    }\n    React.useEffect(() => {\n      if (!subscription.current && handlerRef.current) {\n        const enhancedHandler = (params, event) => {\n          if (!event.defaultMuiPrevented) {\n            handlerRef.current?.(params, event);\n          }\n        };\n        subscription.current = instance.$$subscribeEvent(eventName, enhancedHandler);\n      }\n      if (cleanupTokenRef.current && registryContainer.registry) {\n        // If the effect was called, it means that this render was committed\n        // so we can trust the cleanup function to remove the listener.\n        registryContainer.registry.unregister(cleanupTokenRef.current);\n        cleanupTokenRef.current = null;\n      }\n      return () => {\n        subscription.current?.();\n        subscription.current = null;\n      };\n    }, [instance, eventName]);\n  };\n}\nconst registryContainer = {\n  registry: null\n};\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport const unstable_resetCleanupTracking = () => {\n  registryContainer.registry?.reset();\n  registryContainer.registry = null;\n};\nexport const useInstanceEventHandler = createUseInstanceEventHandler(registryContainer);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}